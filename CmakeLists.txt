cmake_minimum_required(VERSION 3.21)
project(lumal LANGUAGES C CXX)

# Some settings
set(CMAKE_CXX_STANDARD 20)
set(CMAKE_CXX_STANDARD_REQUIRED ON)
set(CMAKE_CXX_EXTENSIONS OFF)
set(CMAKE_EXPORT_COMPILE_COMMANDS ON)
set(CMAKE_COLOR_DIAGNOSTICS ON)
set(CMAKE_INTERPROCEDURAL_OPTIMIZATION TRUE)

# Source files for lumal
file(GLOB_RECURSE LUM_AL_SOURCES
    src/*.cpp
    src/*.c
)

# Create lum-al library
add_library(lumal STATIC ${LUM_AL_SOURCES})
add_subdirectory(external/glfw)
target_link_libraries(lumal PRIVATE glfw)

# Include directories
target_include_directories(lumal PUBLIC
    ${CMAKE_CURRENT_SOURCE_DIR}/src
    ${CMAKE_CURRENT_SOURCE_DIR}/src/defines
    ${CMAKE_CURRENT_SOURCE_DIR}/external
    ${CMAKE_CURRENT_SOURCE_DIR}/external/glfw/include
)

# Optional hello triangle example
option(LUM_AL_BUILD_EXAMPLES "Build lumal examples" ON)

if(LUM_AL_BUILD_EXAMPLES)
    add_executable(triangle_example examples/triangle.cpp)
    target_link_libraries(triangle_example PRIVATE lumal)
    target_include_directories(triangle_example PRIVATE ${CMAKE_CURRENT_SOURCE_DIR}/src)
    set_target_properties(triangle_example PROPERTIES
        RUNTIME_OUTPUT_DIRECTORY ${CMAKE_BINARY_DIR}/bin/examples
    )
endif()
